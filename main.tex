\documentclass{article}
%\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\DeclareMathOperator*{\argmax}{\arg\!\max}
\DeclareMathOperator*{\argmin}{\arg\!\min}
\usepackage{amssymb}
\usepackage{bbm}
\usepackage{wasysym}
\usepackage{xcolor}
\usepackage{gensymb}
\usepackage{graphicx}
\usepackage{bm}
\usepackage{caption}
\usepackage{subcaption}
%\usepackage{algorithm}
\usepackage{algorithm2e}
\usepackage{algpseudocode}
\usepackage{hyperref}
\usepackage{multirow}
\usepackage[superscript,nomove]{cite}
\usepackage{enumitem}
\usepackage[normalem]{ulem}
\usepackage{ifthen}
\newboolean{figs_in_text}
\setboolean{figs_in_text}{false}
\usepackage[margin=1in]{geometry}
%\usepackage[linesnumbered,ruled,vlined]{algorithm2e}
\usepackage[makeroom]{cancel}
\makeatletter 
\g@addto@macro{\@algocf@init}{\SetKwInOut{Parameter}{Arguments}} 
\makeatother 
\graphicspath{{figures/}}
%% Support for easy cross-referencing (e.g. \cref{sec:intro}
% configured with \AtEndPreamble as it needs to be called after hyperref
\usepackage[capitalize]{cleveref}
\crefname{section}{Sec.}{Secs.}
\Crefname{section}{Section}{Sections}
\Crefname{table}{Table}{Tables}
\crefname{table}{Tab.}{Tabs.}

\usepackage{subfiles} % Best loaded last in the preamble

\usepackage{xr}
\externaldocument{supplement}

\usepackage{authblk}

% line numbers
\usepackage{lineno}
\linenumbers

\begin{document}

\title{Kaleidoscopic Scintillation Event Imaging}

\author[1]{Alex Bocchieri*} % (alexb826@gmail.com)}
\author[2,3]{John Mamish}
\author[2]{David Appleyard}
\author[4,5]{Andreas Velten*}% (velten@wisc.edu)}

\affil[1]{Department of Computer Sciences, University of Wisconsin - Madison, Madison, WI, USA}
\affil[2]{Ubicept, Sun Prairie, WI, USA}
\affil[3]{College of Computing, Georgia Institute of Technology, Atlanta, GA, USA}
\affil[4]{Department of Biostatistics and Medical Informatics, University of Wisconsin - Madison, Madison, WI, USA}
\affil[5]{Department of Electrical and Computer Engineering, University of Wisconsin - Madison, Madison, WI, USA}


\date{}

\maketitle
\input{sections/abstract}
\input{sections/intro}
\input{sections/results_format}
%\input{sections/related_work}
%\input{sections/theory}
%\input{sections/localization}
%\input{sections/simulations}
%\input{sections/experiments}
\input{sections/discussion}
\input{sections/methods_format}

\bibliographystyle{unsrt}
\bibliography{references.bib}




\section{Acknowledgments}
\noindent
U.S. Department of Energy (Disclaimer): 
This work was prepared as an account of work sponsored by an agency of the United 
States Government. 
Neither the United States Government nor any agency thereof, nor any of their 
employees, nor any of their contractors, subcontractors or their employees, makes 
any warranty, express or implied, or assumes any legal liability or 
responsibility for the accuracy, completeness, or any third parties use or the 
results of such use of any information, apparatus, product, or process disclosed, 
or represents that its use would not infringe privately owned rights. 
Reference herein to any specific commercial product, process, or service by trade 
name, trademark, manufacturer, or otherwise, does not necessarily constitute or 
imply its endorsement, recommendation, or favoring by the United States 
Government or any agency thereof or its contractors or subcontractors. 
The views and opinions of authors expressed herein do not necessarily state or 
reflect those of the United States Government or any agency thereof, its 
contractors or subcontractors.


\section{Author contributions}
A.B. and A.V. conceived and developed the methods. 
A.B. carried out the experiments. 
A.B. wrote the manuscript with support from A.V..
J.M. developed the FPGA circuitry for actuating and reading from the SPAD sensor. 
D.A. helped modify the light-tight box and provided consultation for setting up and operating the camera.
A.V. acquired funding and provided supervision.


\section{Competing interests}
The authors declare no competing interests.




\newpage

\ifthenelse{\not\boolean{figs_in_text}}{

\begin{figure*}
\centering
\includegraphics[width=\linewidth]{teaser_pipeline.jpg}
\caption{\textbf{Overview of image capture and event localization method.}
An image is composed of light that is emitted from the scintillation event and 
reaches the camera either directly or after reflecting off mirrors of a 
kaleidoscopic scintillator.
The locations of an event's mirror reflections are known for a given event 
location and kaleidoscope geometry.
This relationship between the event and mirror reflections is embedded in a 
Gaussian mixture model whose likelihood is maximized to estimate the event's location.
} 
\label{fig:teaser}
\end{figure*}

\begin{figure}
\centering
\includegraphics[width=\linewidth]{trunc_examples.pdf}
\caption{\textbf{Simulated kaleidoscopic image with theoretical acceptance zones.} 
Acceptance zones are derived for each mirror reflection and overlaid on the image 
for the (a) +$x$, (b) +$y$, (c) -$x$, and (d) -$y$ mirror reflections.} 
\label{fig:trunc_examples}
\end{figure}


\begin{figure*}
\centering
\includegraphics[width=\linewidth]{example_figures.pdf}
\caption{\textbf{Selected experimental images.} Experimental images overlaid with the algorithm's estimated Gaussians.
Each dashed red circle is centered on the Gaussian component's mean. 
The inner and outer circles are one and two standard deviations in radius, respectively.
Pixels with a photon are enlarged with a $3 \times 3$ filter for visualization purposes.
} 
\label{fig:example_figures}
\end{figure*}



\begin{figure*}
\centering
\includegraphics[width=\linewidth]{crossval_error.pdf}
\caption{\textbf{Agreement in event location measurements.} Histogram of distances between mean estimated event location and each image's estimated event location after mirror reflection removals. 
(a) Distances including both single and double mirror reflection removals. Mean $\pm$ stdev: 0.24 $\pm$ 0.34 mm, 24,761 distances.
(b) Distances including single mirror reflection removal. Mean $\pm$ stdev: 0.16 $\pm$ 0.28 mm, 11,255 distances.
(c) Distances including double mirror reflection removal. Mean $\pm$ stdev: 0.27 $\pm$ 0.35 mm, 15,757 distances.
} 
\label{fig:crossval_error}
\end{figure*}


\begin{figure*}
\centering
\includegraphics[width=\linewidth]{fixed_init_results.pdf}
\caption{\textbf{Optimization convergence.}
(a) Distances in estimated event locations between the regular and fixed initialization methods. Mean $\pm$ stdev: $0.38 \pm 0.80$ mm, 4,351 events.
(b) Nummber of steps taken in the EM algorithm from the regular initialization point. Mean $\pm$ stdev: $9.3 \pm 14.2$ steps, 4,351 events.
(c) Nummber of steps taken in the EM algorithm from the fixed initialization point. Mean $\pm$ stdev: $13.5 \pm 14.9$ steps, 4,351 events.
} 
\label{fig:convergence}
\end{figure*}


\begin{figure}
\centering
\includegraphics[width=.33\linewidth]{optical_config.pdf}
\caption{\textbf{Imaging parameters and coordinate systems.} 
The optical configuration consists of a lens with diameter $A$, distance from 
lens to focal plane $S_1$, and distance from lens to sensor $S_2$. The diameter 
of an event's image on the sensor is $c$. The camera is focused at the 
scintillator's apex where the world coordinate system origin is located. The 
camera coordinate system origin is located at the lens. The figure only shows 
light emitted directly to the camera.} 
\label{fig:optical_config}
\end{figure}


\begin{figure*}
\centering
\includegraphics[width=\linewidth]{trunc_theory.pdf}
\caption{\textbf{Mirror apertures and image truncations.} 
An event emits light onto a mirror that reflects into the camera. 
Some light might not reach the sensor due to finite mirrors and defocus blur.
(a) The mirror reflection is located beyond the focal plane. 
All light that forms the mirror reflection reaches the sensor.
(b) The mirror reflection is located beyond the focal plane. 
Some light from the mirror reflection is stopped at the mirror's edge and 
truncated on the sensor.
(c) The mirror reflection is located within the focal plane.
All light that forms the mirror reflection reaches the sensor.
(d) The mirror reflection is located within the focal plane. 
Some light from the mirror reflection is stopped at the mirror's edge and 
truncated on the sensor.
(e) Light from a double mirror reflection is stopped at both mirrors' edges and truncated on the sensor. 
The mirror for the second reflection is illustrated along the optical axis.} 
\label{fig:trunc_theory}
\end{figure*}


\begin{figure}
\centering
\includegraphics[width=.4\linewidth]{trunc_teaser.jpg}
\caption{\textbf{Image truncation example in 3D.}
The image of an event and one mirror reflection is shown. 
Light corresponding to the mirror reflection is truncated at the mirror's edge, 
resulting in a truncation line in the image.
The truncation line only applies to that mirror reflection.}
\label{fig:trunc_teaser}
\end{figure}  





\begin{figure*}
\centering
\includegraphics[width=\linewidth]{calibration.pdf}
\caption{\textbf{Experimental calibration image.} a) The original image. b) The image after manually 
removing dark counts overlaid with the Gaussian components found during the 
calibration procedure.
Each dashed red circle is centered on the Gaussian component's mean. 
The inner and outer circles are one and two standard deviations in radius, respectively.
Pixels with a photon are enlarged with a $3 \times 3$ filter for visualization purposes.
} 
\label{fig:calibration}
\end{figure*}


\begin{table}[h!]
\centering
\begin{tabular}{|c|ccccc|}
\hline
Counts in a test image & 60 - 79 & 80 - 99 & 100 - 119 & 120 - 139 & 140 - 159 \\
\hline
Mean (mm)                & 0.28 & 0.26 & 0.19 & 0.19 & 0.15 \\
Standard dev.  (mm)      & 0.36 & 0.35 & 0.30 & 0.29 & 0.21  \\
Number of distances    & 9,317  & 7,524  & 4,774  & 2,354  & 792 \\
\hline
\end{tabular}
\caption{\textbf{Agreement in event location measurements.} Mean and standard deviation of distances between mean estimated 
event location and each image's estimated event location after both single and 
double mirror reflection removals reported over different ranges of counts in a 
test image.}
\label{tab:crossval_thresh_error}
\end{table}

  
}{}




\end{document}
